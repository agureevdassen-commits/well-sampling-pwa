<div class="page-home">
  <header class="page-header">
    <h1>üè† –ì–ª–∞–≤–Ω–∞—è</h1>
  </header>

  <div class="content">
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-section">
      <div class="stat-card primary">
        <div class="stat-icon">üî≤</div>
        <div class="stat-info">
          <div class="stat-label">–í—Å–µ–≥–æ —Å–∫–≤–∞–∂–∏–Ω</div>
          <div class="stat-value" id="totalWells">0</div>
        </div>
      </div>

      <div class="stat-card success">
        <div class="stat-icon">‚úì</div>
        <div class="stat-info">
          <div class="stat-label">–û–ø—Ä–æ–±–æ–≤–∞–Ω–æ</div>
          <div class="stat-value" id="sampledWells">0</div>
        </div>
      </div>

      <div class="stat-card warning">
        <div class="stat-icon">‚óã</div>
        <div class="stat-info">
          <div class="stat-label">–ù–µ –æ–ø—Ä–æ–±–æ–≤–∞–Ω–æ</div>
          <div class="stat-value" id="unsampledWells">0</div>
        </div>
      </div>

      <div class="stat-card info">
        <div class="stat-icon">üìà</div>
        <div class="stat-info">
          <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
          <div class="stat-value" id="completionPercentage">0%</div>
        </div>
      </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
    <div class="card">
      <div class="card-header">–•–æ–¥ –æ–ø—Ä–æ–±–æ–≤–∞–Ω–∏—è</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
      <div class="progress-text" id="progressText">0 –∏–∑ 0</div>
    </div>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ DVG —Ñ–∞–π–ª–∞ -->
    <div class="card">
      <div class="card-header">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–µ—Å—Ç—Ä —Å–∫–≤–∞–∂–∏–Ω (DVG)</div>
      <input type="file" id="dvgFile" accept=".xlsx,.xls,.csv" style="width: 100%; margin: 8px 0;">
      <button class="btn btn-primary btn-block" onclick="uploadDVG()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
    </div>

    <!-- –î–µ–π—Å—Ç–≤–∏—è -->
    <div class="card">
      <div class="card-header">‚öôÔ∏è –î–µ–π—Å—Ç–≤–∏—è</div>
      <button class="btn btn-secondary btn-block" onclick="startScanning()">üì∑ –ù–∞—á–∞—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
      <button class="btn btn-secondary btn-block" onclick="viewSamples()">üìä –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–±—ã</button>
      <button class="btn btn-secondary btn-block" onclick="manageDuplicates()">üîÑ –£–ø—Ä–∞–≤–ª—è—Ç—å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏</button>
    </div>

    <!-- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è -->
    <div class="card">
      <div class="card-header">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</div>
      <div class="flex-between mb-2">
        <span>–°—Ç–∞—Ç—É—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:</span>
        <span id="connectionStatus" class="badge badge-info">üî¥ –ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
      </div>
      <div class="flex-between mb-2">
        <span>–ù–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±—ã:</span>
        <span id="unsyncedCount" class="badge badge-warning">0</span>
      </div>
      <button class="btn btn-primary btn-block" onclick="syncNow()">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
      <button class="btn btn-secondary btn-block" onclick="clearData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="card">
      <div class="card-header">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
      <p class="mb-2"><strong>–í–µ—Ä—Å–∏—è:</strong> 1.0</p>
      <p class="mb-2"><strong>–†–µ–∂–∏–º:</strong> <span id="modeIndicator">–û—Ñ–ª–∞–π–Ω</span></p>
      <p class="mb-2"><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> <input type="text" id="userNameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" style="width: 100%; padding: 6px; margin: 4px 0; border: 1px solid #ddd; border-radius: 4px;"></p>
      <button class="btn btn-secondary btn-block" onclick="saveUserName()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<style>
.page-home { padding: 12px; }

.page-header {
  padding: 12px 0;
  border-bottom: 2px solid var(--primary-color);
  margin-bottom: 16px;
}

.page-header h1 {
  font-size: 24px;
  margin: 0;
}

.content {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.stats-section {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.stat-card {
  background: white;
  border-radius: 8px;
  padding: 12px;
  display: flex;
  gap: 10px;
  align-items: center;
  box-shadow: var(--shadow);
}

.stat-card.primary { border-left: 4px solid var(--primary-color); }
.stat-card.success { border-left: 4px solid var(--success-color); }
.stat-card.warning { border-left: 4px solid var(--warning-color); }
.stat-card.info { border-left: 4px solid #667eea; }

.stat-icon {
  font-size: 24px;
}

.stat-info {
  flex: 1;
}

.stat-label {
  font-size: 12px;
  color: var(--text-secondary);
}

.stat-value {
  font-size: 20px;
  font-weight: bold;
  color: var(--text-primary);
}

.progress-text {
  text-align: center;
  margin-top: 8px;
  font-size: 12px;
  color: var(--text-secondary);
}
</style>

<script>
// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
(async () => {
  try {
    const stats = await db.getStatistics();
    
    document.getElementById('totalWells').textContent = stats.totalWells;
    document.getElementById('sampledWells').textContent = stats.sampledWells;
    document.getElementById('unsampledWells').textContent = stats.unsampledWells;
    document.getElementById('completionPercentage').textContent = stats.completionPercentage + '%';
    
    const progressFill = document.getElementById('progressFill');
    progressFill.style.width = stats.completionPercentage + '%';
    
    document.getElementById('progressText').textContent = 
      `${stats.sampledWells} –∏–∑ ${stats.totalWells}`;

    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const savedName = localStorage.getItem('userName');
    if (savedName) {
      currentUser = savedName;
      document.getElementById('userNameInput').value = savedName;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    updateConnectionStatus();

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–±
    const unsynced = await db.getUnsyncedWells();
    document.getElementById('unsyncedCount').textContent = unsynced.length;

  } catch (error) {
    console.error('Home page error:', error);
  }
})();

function updateConnectionStatus() {
  const status = navigator.onLine ? '‚úÖ –û–Ω–ª–∞–π–Ω' : 'üî¥ –û—Ñ–ª–∞–π–Ω';
  const badge = document.getElementById('connectionStatus');
  badge.textContent = status;
  badge.className = navigator.onLine ? 'badge badge-success' : 'badge badge-danger';
  
  const modeIndicator = document.getElementById('modeIndicator');
  modeIndicator.textContent = navigator.onLine ? '–û–Ω–ª–∞–π–Ω' : '–û—Ñ–ª–∞–π–Ω';
}

function uploadDVG() {
  const file = document.getElementById('dvgFile').files;
  if (!file) {
    showNotification('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª', 'warning');
    return;
  }
  importFromExcel(file);
}

function startScanning() {
  loadPage('scanner');
}

function viewSamples() {
  loadPage('samples');
}

function manageDuplicates() {
  loadPage('duplicates');
}

async function syncNow() {
  showNotification('üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...', 'info');
  if ('serviceWorker' in navigator && 'SyncManager' in window) {
    const registration = await navigator.serviceWorker.ready;
    try {
      await registration.sync.register('sync-samples');
      await registration.sync.register('sync-duplicates');
      showNotification('‚úì –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞', 'success');
    } catch (error) {
      showNotification(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
    }
  } else {
    showNotification('‚ö†Ô∏è Background Sync –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'warning');
  }
}

async function clearData() {
  if (confirm('‚ùå –í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')) {
    try {
      showLoading(true);
      await db.clearAllData();
      localStorage.clear();
      showNotification('‚úì –î–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã', 'success');
      location.reload();
    } catch (error) {
      showNotification(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
    } finally {
      showLoading(false);
    }
  }
}

function saveUserName() {
  const name = document.getElementById('userNameInput').value.trim();
  if (name) {
    currentUser = name;
    localStorage.setItem('userName', name);
    showNotification(`‚úì –ò–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ${name}`, 'success');
  } else {
    showNotification('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –∏–º—è', 'warning');
  }
}

// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
window.addEventListener('online', updateConnectionStatus);
window.addEventListener('offline', updateConnectionStatus);

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
setInterval(async () => {
  const stats = await db.getStatistics();
  document.getElementById('totalWells').textContent = stats.totalWells;
  document.getElementById('sampledWells').textContent = stats.sampledWells;
  document.getElementById('completionPercentage').textContent = stats.completionPercentage + '%';
  const progressFill = document.getElementById('progressFill');
  progressFill.style.width = stats.completionPercentage + '%';
  updateConnectionStatus();
}, 30000);
</script>
